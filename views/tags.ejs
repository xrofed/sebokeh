<%- include('partials/header') %>

<div class="flex items-center justify-between mb-8 border-b border-gray-800 pb-4">
  <div class="flex items-center gap-3">
    <div class="w-1.5 h-8 bg-pink-600 rounded-full shadow-[0_0_10px_rgba(236,72,153,0.5)]"></div>
    <h2 class="text-2xl font-black text-white tracking-tight uppercase">
      Tag: <span class="text-pink-500">#<%= display_tag %></span>
    </h2>
  </div>
  <div class="hidden md:block text-xs text-gray-500 font-medium bg-gray-900 px-3 py-1 rounded-full border border-gray-800">
    <%= totalVideos %> Video Ditemukan
  </div>
</div>

<!-- TAMBAHKAN DESCRIPTION SEO FRIENDLY -->
<div class="mb-8 bg-gray-900/50 border border-gray-800 rounded-xl p-4 md:p-6">
  <p class="text-gray-300 leading-relaxed text-sm md:text-base">
    Kumpulan video #<%= display_tag %> dengan berbagai jenis adegan.
    Koleksi #<%= display_tag %> terlengkap.
    Update terbaru setiap hari. Nonton video #<%= display_tag %> gratis tanpa iklan di <%= site_name %>.
  </p>
</div>

<% if (videos.length > 0) {
  %>
  <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 md:gap-5 mb-12">
    <% videos.forEach((vid, index) => { 
        // Setup variabel
        let thumb = vid.thumbnail || '/uploads/default-poster.jpg';
        if (!thumb.startsWith('http')) thumb = site_url + '/' + thumb;
        
        let views = vid.views || 0;
        let duration = formatDuration(vid.duration_sec);
        
        // SEO Tag Classes (agar tetap ada di DOM untuk struktur)
        let tagClasses = '';
        if (vid.tags && Array.isArray(vid.tags)) {
            tagClasses = vid.tags.map(t => 'tag-' + t.toLowerCase().trim().replace(/ /g, '-')).join(' ');
        }
    %>

    <article 
        class="group relative bg-gray-900 rounded-lg overflow-hidden border border-gray-800 hover:border-pink-500/50 hover:shadow-[0_0_15px_rgba(236,72,153,0.15)] transition-all duration-300 <%= tagClasses %>"
        data-video-id="<%= vid._id %>">

        <a href="/video/<%= vid.slug %>" title="<%= vid.title %>" class="block">
            
            <div class="relative w-full aspect-video overflow-hidden bg-gray-800">
                <img src="<%= thumb %>" 
                     alt="<%= vid.title %>"
                     class="w-full h-full object-cover transform group-hover:scale-110 transition duration-700 ease-out"
                     loading="<%= index < 8 ? 'eager' : 'lazy' %>">
                
                <div class="absolute inset-0 bg-black/20 group-hover:bg-black/0 transition-all"></div>

                <div class="absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                    <div class="bg-pink-600/90 rounded-full p-2 shadow-lg backdrop-blur-sm">
                      <svg class="w-6 h-6 text-white pl-0.5" fill="currentColor" viewBox="0 0 20 20"><path d="M4.5 2.69l11.01 7.31L4.5 17.31V2.69z"></path></svg>
                    </div>
                </div>

                <div class="absolute bottom-1.5 left-1.5 bg-black/70 backdrop-blur-sm px-1.5 py-0.5 rounded text-[10px] text-white flex items-center gap-1 border border-white/10">
                    <i class="fa fa-eye text-gray-400"></i>
                    <span><%= views.toLocaleString() %></span>
                </div>

                <div class="absolute bottom-1.5 right-1.5 bg-black/70 backdrop-blur-sm px-1.5 py-0.5 rounded text-[10px] text-white font-mono border border-white/10">
                    <%= duration %>
                </div>
            </div>

            <div class="w-full h-1 bg-gray-800 relative">
               <% let ratingPercent = Math.floor(Math.random() * (100 - 85 + 1) + 85); %>
               <div class="h-full bg-green-500 absolute top-0 left-0" style="width: <%= ratingPercent %>%"></div>
            </div>

            <div class="p-3">
                <header>
                    <h2 class="font-bold text-sm leading-snug h-10 line-clamp-2 mb-2">
                        <%= vid.title %>
                    </h2>
                </header>
                
                <div class="flex items-center justify-between mt-2 pt-2 border-t border-gray-800">
                    <span class="text-[10px] text-gray-500">
                      <%= new Date(vid.upload_date).toLocaleDateString('id-ID', {day:'numeric', month:'short'}) %>
                    </span>
                    
                    <div class="flex items-center gap-1 text-[10px] text-gray-400">
                      <i class="fa fa-thumbs-up text-green-500/80"></i>
                      <span><%= ratingPercent %>%</span>
                    </div>
                </div>
            </div>

        </a>
    </article>

    <% }) %>
  </div>

  <% if (totalPages > 1) {
    %>
    <div class="flex justify-center items-center gap-2 mt-8 mb-20">
      <% if (currentPage > 1) {
        %>
        <a href="/tag/<%= tagSlug %>?page=<%= currentPage - 1 %>"
          class="w-10 h-10 flex items-center justify-center bg-gray-800 text-white rounded-lg hover:bg-pink-600 transition shadow-lg border border-gray-700">&larr;</a>
        <%
      } %>

      <div class="px-6 py-2 bg-gray-900 border border-gray-800 rounded-lg text-sm font-medium shadow-inner">
        <span class="text-pink-500 font-bold"><%= currentPage %></span>
        <span class="text-gray-600 mx-2">/</span>
        <span class="text-gray-400"><%= totalPages %></span>
      </div>

      <% if (currentPage < totalPages) {
        %>
        <a href="/tag/<%= tagSlug %>?page=<%= currentPage + 1 %>"
          class="w-10 h-10 flex items-center justify-center bg-gray-800 text-white rounded-lg hover:bg-pink-600 transition shadow-lg border border-gray-700">&rarr;</a>
        <%
      } %>
    </div>
    <%
  } %>

  <%
} else {
  %>
  <div class="min-h-[50vh] flex flex-col items-center justify-center text-center bg-gray-900/50 border border-gray-800 rounded-2xl p-10">
    <div class="text-6xl mb-4">
      ðŸ“‚
    </div>
    <h3 class="text-xl font-bold text-white mb-2">Belum ada video</h3>
    <p class="text-gray-500 mb-6">
      Maaf, belum ada video dengan tag <span class="text-pink-500">#<%= display_tag %></span>.
    </p>
    <a href="/" class="px-6 py-2 bg-pink-600 hover:bg-pink-700 text-white rounded-full transition font-medium">Kembali ke Beranda</a>
  </div>
  <%
} %>

<%- include('partials/footer') %>